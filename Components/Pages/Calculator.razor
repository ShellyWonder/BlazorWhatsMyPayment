@* Calculator *@
@page "/calculator"
<div class="container-xxl my-3">
    <h1 class="mb-2 text-center logFont">What's My Payment?</h1>
    <div>
        @* Instructions *@
        <div class="instructions-container rounded-4 p-4 mb-4 shadow-sm">
            <h4 class="mb-3 text-center fw-bold text-black">How It Works</h4>
            <p class="lead">
                Take the guesswork out of loan planning. This loan calculator helps you explore different loan scenarios before ever speaking with a lender.
                Just enter these three items into the form below and let the app do the math!
            </p>
            <ul class="list-group list-group-flush my-4">
                <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-1-circle-fill text-success me-2 mt-1"></i>
                    <div>
                        <strong>Principal Requested</strong> – The loan amount you're considering borrowing
                    </div>
                </li>
                <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-2-circle-fill text-success me-2 mt-1"></i>
                    <div>
                        <strong>Interest Rate</strong> – Your expected annual interest rate
                    </div>
                </li>
                <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-3-circle-fill text-success me-2 mt-1"></i>
                    <div>
                        <strong>Loan Term</strong> – How many years you plan to take to repay the loan
                    </div>
                </li>
            </ul>

            <div class="alert alert-success mt-4">
                <i class="bi bi-lightbulb-fill me-2"></i>
                Adjust the numbers as much as you like to find a loan structure that fits your budget and financial goals.
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-md-6 loanForm p-2 rounded-3">
                <h4 class="mt-4">Loan Calculator</h4>
                <EditForm EditContext="editContext"OnValidSubmit="HandleSubmit">
                    <DataAnnotationsValidator />
                    <ValidationSummary />
                    <div class="row gy-2">

                        <div class="col-12 mb-3">
                            <label for="purchaseAmount" class="form-label">Purchase Amount:</label>
                            <InputNumber id="purchaseAmount" @bind-Value="loan.PurchaseAmount" class="form-control" step="100" />
                            <ValidationMessage For="@(() => loan.PurchaseAmount)" />
                        </div>
                        <div class="col-12 mb-3">
                            <label for="loanTerm" class="form-label">Loan Term(Years):</label>
                            <InputNumber id="loanTerm" @bind-Value="loan.Term" class="form-control" min="1" />
                            <ValidationMessage For="@(() => loan.Term)" />
                        </div>
                        <div class="col-12 mb-3">
                            <label for="interestRate" class="form-label">Interest Rate:</label>
                            <InputNumber id="interestRate" @bind-Value="loan.Rate" class="form-control" min="0.0" step=".1" />
                            <ValidationMessage For="@(() => loan.Rate)" />
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary mt-3"><i class="bi bi-calculator-fill me-2"></i>Calculate</button>
                        </div>
                    </div>
                </EditForm>
            </div>
            <div class="col-12 col-md-6 d-flex flex-column justify-content-between px-4 mt-4-md-0">
                <h3 class="payment">
                    Your Monthly Payment
                </h3>
                <div class="display-1 payment">
                    @loan.Payment.ToString("C2")
                </div>
                <div class="row border border-1 g-0 p-3">
                    <div class="col-6">
                        <label class="text-start">Purchase Amount</label>
                    </div>
                    <div class="col-6 text-end">
                        @loan.PurchaseAmount.ToString("C2")
                    </div>
                    <div class="col-6">
                        <label class="text-start">Total Interest</label>
                    </div>
                    <div class="col-6 text-end">
                        @loan.TotalInterest.ToString("C2")
                    </div>
                    <div class="col-6">
                        <label class="text-start totalCost">Total Cost</label>
                    </div>
                    <div class="col-6 text-end totalCost">
                        @loan.TotalCost.ToString("C2")
                    </div>
                </div>
                <div class="text-end mt-2">
                    <button class="btn btn-primary"><i class="bi bi-calendar2-check me-2"></i>Show Payment Schedule</button>

                </div>
            </div>
        </div>
    </div>
</div>


@code {
    private Loan loan = new Loan();
    EditContext? editContext;

    protected override void OnInitialized()
    {
        editContext = new EditContext(loan);
        loan.PurchaseAmount = 25000;
        loan.Term = 5;
        loan.Rate = 5.0;
    }
    private void HandleSubmit()
    {
        loan.Payment= LoanUtils.CalcPayment(loan.PurchaseAmount, loan.Rate, loan.Term);
        editContext?.NotifyValidationStateChanged();
    }
}
